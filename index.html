<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‹œì¸ì˜ ë°œìì·¨: ìœ¤ë™ì£¼ì˜ 1941ë…„ ì„œìš¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500;700&family=Noto+Sans+KR:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
            color: #292524; /* stone-800 */
        }
        
        h1, h2, h3, .serif-font {
            font-family: 'Noto Serif KR', serif;
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            height: 300px;
            max-height: 400px;
            margin: 0 auto;
        }

        .nav-item.active {
            border-bottom: 3px solid #78350f; /* amber-900 */
            color: #78350f;
            font-weight: 700;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #78350f;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <!-- Chosen Palette: Warm Paper & Ink (Stone background, Amber accents, Slate text) -->
    <!-- Application Structure Plan: A 'Digital Field Guide' structure. Added âœ¨ AI Insight (Gemini API) and visual route map to facilitate spatial and emotional understanding of Yun Dong-ju's 1941 Seoul. -->
</head>
<body class="flex flex-col min-h-screen">

    <!-- Header -->
    <header class="bg-stone-200 border-b border-stone-300 sticky top-0 z-50">
        <div class="max-w-4xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl md:text-3xl font-bold text-stone-800 serif-font">ì‹œì¸ì˜ ë°œìì·¨</h1>
                <p class="text-sm text-stone-600 mt-1">ìœ¤ë™ì£¼ì˜ 1941ë…„ ì„œìš¸, ê·¸ ê¸¸ì„ ê±·ë‹¤</p>
            </div>
            <button id="menu-toggle" onclick="toggleMobileMenu()" class="md:hidden text-2xl text-stone-800">â˜°</button>
        </div>
        <!-- Navigation -->
        <nav id="main-nav" class="max-w-4xl mx-auto px-4 overflow-x-auto no-scrollbar hidden md:block">
            <ul class="flex space-x-8 text-stone-500 whitespace-nowrap pb-2">
                <li><button onclick="navigateTo('intro')" class="nav-item py-2 hover:text-stone-800 transition-colors active" data-target="intro">ë‹µì‚¬ ì‹œì‘</button></li>
                <li><button onclick="navigateTo('course1')" class="nav-item py-2 hover:text-stone-800 transition-colors" data-target="course1">ì½”ìŠ¤ 1: ëˆ„ìƒë™ í•˜ìˆ™ì§‘</button></li>
                <li><button onclick="navigateTo('course2')" class="nav-item py-2 hover:text-stone-800 transition-colors" data-target="course2">ì½”ìŠ¤ 2: ì „ì°¨ì˜ ê¸¸</button></li>
                <li><button onclick="navigateTo('course3')" class="nav-item py-2 hover:text-stone-800 transition-colors" data-target="course3">ì½”ìŠ¤ 3: í†µí•™ ê¸°ì°¨</button></li>
                <li><button onclick="navigateTo('ai-hub')" class="nav-item py-2 hover:text-stone-800 transition-colors" data-target="ai-hub">âœ¨ AI ì²´í—˜ ì„¼í„°</button></li>
                <li><button onclick="navigateTo('activities')" class="nav-item py-2 hover:text-stone-800 transition-colors" data-target="activities">í•™ìƒ í™œë™</button></li>
            </ul>
        </nav>
    </header>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden bg-stone-100 border-b border-stone-300 md:hidden">
        <ul class="flex flex-col p-4 space-y-2">
            <li><button onclick="navigateTo('intro'); toggleMobileMenu()" class="block w-full text-left py-2 px-4 rounded hover:bg-stone-200">ë‹µì‚¬ ì‹œì‘</button></li>
            <li><button onclick="navigateTo('course1'); toggleMobileMenu()" class="block w-full text-left py-2 px-4 rounded hover:bg-stone-200">ì½”ìŠ¤ 1: ëˆ„ìƒë™ í•˜ìˆ™ì§‘</button></li>
            <li><button onclick="navigateTo('course2'); toggleMobileMenu()" class="block w-full text-left py-2 px-4 rounded hover:bg-stone-200">ì½”ìŠ¤ 2: ì „ì°¨ì˜ ê¸¸</button></li>
            <li><button onclick="navigateTo('course3'); toggleMobileMenu()" class="block w-full text-left py-2 px-4 rounded hover:bg-stone-200">ì½”ìŠ¤ 3: í†µí•™ ê¸°ì°¨</button></li>
            <li><button onclick="navigateTo('ai-hub'); toggleMobileMenu()" class="block w-full text-left py-2 px-4 rounded hover:bg-stone-200">âœ¨ AI ì²´í—˜ ì„¼í„°</button></li>
            <li><button onclick="navigateTo('activities'); toggleMobileMenu()" class="block w-full text-left py-2 px-4 rounded hover:bg-stone-200">í•™ìƒ í™œë™</button></li>
        </ul>
    </div>

    <!-- Main Content Area -->
    <main class="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
        
        <!-- SECTION: INTRO -->
        <section id="intro" class="fade-in">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200 mb-8">
                <h2 class="text-2xl font-bold mb-4 serif-font text-stone-800">1941ë…„, ì‹œê°€ íë¥´ëŠ” ì„œìš¸ë¡œì˜ ì´ˆëŒ€</h2>
                <p class="text-lg leading-relaxed text-stone-700 mb-6">
                    ë³¸ í”„ë¡œì íŠ¸ëŠ” 1941ë…„, ìœ¤ë™ì£¼ ì‹œì¸ì´ ë¨¸ë¬¼ë €ë˜ ì„œì´Œ ëˆ„ìƒë™ í•˜ìˆ™ì§‘ë¶€í„° ì—°í¬ì „ë¬¸í•™êµ ë“±êµ£ê¸¸ê¹Œì§€ì˜ ì—¬ì •ì„ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ì‹œì¸ì˜ ë°œìì·¨ë¥¼ ë”°ë¼ ê±¸ìœ¼ë©° ì—­ì‚¬ì™€ ë¬¸í•™ì„ ë™ì‹œì— ì²´í—˜í•´ ë³´ì„¸ìš”.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                    <div class="bg-stone-50 p-4 rounded text-center border border-stone-200 cursor-pointer hover:bg-stone-100 transition" onclick="navigateTo('course1')">
                        <div class="text-3xl mb-2">ğŸ </div>
                        <h3 class="font-bold text-stone-800">ì½”ìŠ¤ 1: ëˆ„ìƒë™</h3>
                        <p class="text-sm text-stone-600">ë¬¸í•™ì˜ ìš”ëŒ</p>
                    </div>
                    <div class="bg-stone-50 p-4 rounded text-center border border-stone-200 cursor-pointer hover:bg-stone-100 transition" onclick="navigateTo('course2')">
                        <div class="text-3xl mb-2">ğŸš‹</div>
                        <h3 class="font-bold text-stone-800">ì½”ìŠ¤ 2: ì „ì°¨ê¸¸</h3>
                        <p class="text-sm text-stone-600">ì¢…ì ê³¼ ì‹œì </p>
                    </div>
                    <div class="bg-stone-50 p-4 rounded text-center border border-stone-200 cursor-pointer hover:bg-stone-100 transition" onclick="navigateTo('course3')">
                        <div class="text-3xl mb-2">ğŸš‚</div>
                        <h3 class="font-bold text-stone-800">ì½”ìŠ¤ 3: í†µí•™ê¸¸</h3>
                        <p class="text-sm text-stone-600">í¬ë§ê³¼ ë¹„ê·¹</p>
                    </div>
                </div>

                <!-- MAIN IMAGE 1 -->
                <div class="mt-10">
                    <img src="https://postfiles.pstatic.net/MjAyNTA3MjNfMTg1/MDAxNzUzMjMwNDg5NTQ5.z1C1PXlAZQ94e2O5X8z-Du8Iu0wP_XuPE4D6SRKpXlsg.VCiA-zp81IP3n8hfgDKjRGcNn078gE6QPKcfxf_lWkYg.JPEG/%EC%9C%A4%EB%8F%99%EC%A3%BC%EB%AC%B8%ED%95%99%EA%B4%80_%EC%9D%B8%EC%99%95%EC%82%B0%EC%9E%90%EB%9D%BD%EA%B8%B8.jpg?type=w966" 
                         alt="ìœ¤ë™ì£¼ ë¬¸í•™ê´€ ë° ì¸ì™•ì‚° ìë½ê¸¸ í’ê²½" 
                         class="w-full h-auto rounded-lg shadow-md border border-stone-200">
                    <p class="text-xs text-stone-500 mt-2 text-right italic">ìœ¤ë™ì£¼ ë¬¸í•™ê´€ ë° ì¸ì™•ì‚° ìë½ê¸¸ ì „ê²½</p>
                </div>

                <!-- ROUTE MAP IMAGE 2 (Newly Added) -->
                <div class="mt-8 border-t border-stone-100 pt-8">
                    <h3 class="text-lg font-bold mb-4 text-stone-800 flex items-center">
                        <span class="mr-2">ğŸ“</span> ë‹µì‚¬ ê²½ë¡œ ìƒì„¸ ì§€ë„
                    </h3>
                    <img src="https://github.com/jj304242/ghs0120/blob/main/1.png?raw=true" 
                         alt="ìœ¤ë™ì£¼ ì„œìš¸ ë‹µì‚¬ ê²½ë¡œ ì§€ë„" 
                         class="w-full h-auto rounded-lg shadow-md border border-stone-200"
                         onerror="this.src='https://via.placeholder.com/800x600?text=ì§€ë„ë¥¼+ë¶ˆëŸ¬ì˜¬+ìˆ˜+ì—†ìŠµë‹ˆë‹¤';">
                    <p class="text-xs text-stone-500 mt-2 text-right italic">ì„œì´Œì—ì„œ ì—°í¬ê¹Œì§€: ì‹œì¸ì˜ ë“±êµ£ê¸¸ ë…¸ì„ </p>
                </div>
            </div>
        </section>

        <!-- SECTION: AI HUB (âœ¨ Gemini Integration) -->
        <section id="ai-hub" class="hidden fade-in">
            <div class="border-l-4 border-amber-800 pl-4 mb-6">
                <h2 class="text-2xl font-bold serif-font text-stone-800">âœ¨ AI ì²´í—˜ ì„¼í„°</h2>
                <p class="text-amber-900 font-medium">Gemini AIë¥¼ í†µí•´ ì‹œì¸ì˜ ì‹œëŒ€ë¥¼ ë”ìš± ì…ì²´ì ìœ¼ë¡œ ê²½í—˜í•©ë‹ˆë‹¤.</p>
            </div>

            <div class="grid grid-cols-1 gap-8">
                <!-- AI Poet Chat -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <span class="mr-2">ğŸ’¬</span> ì‹œì¸ê³¼ ë§ˆìŒ ë‚˜ëˆ„ê¸°
                    </h3>
                    <div id="chat-box" class="h-64 overflow-y-auto mb-4 bg-stone-50 p-4 rounded border border-stone-200 space-y-3">
                        <div class="text-stone-500 text-sm italic">ì‹œì¸ ìœ¤ë™ì£¼ì—ê²Œ ê¶ê¸ˆí•œ ì ì„ ë¬¼ì–´ë³´ì„¸ìš”. (ì˜ˆ: "ëˆ„ìƒë™ í•˜ìˆ™ì§‘ì€ ì–´ë–¤ê°€ìš”?")</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" class="flex-grow p-2 border border-stone-300 rounded focus:ring-2 ring-amber-500 outline-none" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...">
                        <button onclick="askAI()" id="chat-btn" class="bg-amber-800 text-white px-6 py-2 rounded hover:bg-amber-900 transition flex items-center gap-2">
                            <span>âœ¨ ì§ˆë¬¸í•˜ê¸°</span>
                            <div id="chat-loader" class="spinner hidden"></div>
                        </button>
                    </div>
                </div>

                <!-- AI Image Generation -->
                <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <span class="mr-2">ğŸ¨</span> 1941ë…„ ê²½ì„± ìŠ¤ì¼€ì¹˜
                    </h3>
                    <p class="text-sm text-stone-600 mb-4">ì‹œì¸ì˜ ëˆˆì— ë¹„ì³¤ì„ ë‹¹ì‹œì˜ í’ê²½ì„ AIë¡œ ê·¸ë ¤ë´…ë‹ˆë‹¤. (ì˜ˆ: "ëˆˆ ë‚´ë¦¬ëŠ” ë°¤ì˜ íš¨ìë™ ì „ì°¨ ì •ë¥˜ì¥")</p>
                    <div class="flex gap-2 mb-4">
                        <input type="text" id="image-prompt" class="flex-grow p-2 border border-stone-300 rounded outline-none" placeholder="í’ê²½ ë¬˜ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                        <button onclick="generateAIImage()" id="image-btn" class="bg-stone-700 text-white px-6 py-2 rounded hover:bg-stone-800 transition flex items-center gap-2">
                            <span>âœ¨ ì´ë¯¸ì§€ ìƒì„±</span>
                            <div id="image-loader" class="spinner hidden"></div>
                        </button>
                    </div>
                    <div id="image-result" class="min-h-[300px] border-2 border-dashed border-stone-200 rounded flex items-center justify-center bg-stone-50 relative">
                        <div class="text-stone-400">ìƒì„±ëœ ì´ë¯¸ì§€ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: COURSE 1 -->
        <section id="course1" class="hidden fade-in">
            <div class="border-l-4 border-amber-800 pl-4 mb-6">
                <h2 class="text-2xl font-bold serif-font text-stone-800">ì½”ìŠ¤ 1: ëˆ„ìƒë™ í•˜ìˆ™ì§‘</h2>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200 mb-6">
                <p class="text-stone-700 leading-relaxed">
                    1941ë…„ 5ì›”~9ì›”, ì‹œì¸ì´ ì •ë³‘ìš±ê³¼ í•¨ê»˜ ë¨¸ë¬¼ë©° ëŒ€í‘œì‘ 9í¸ì„ ì§‘í•„í•œ ê³³ì…ë‹ˆë‹¤.
                </p>
                <div class="mt-6">
                    <div class="chart-container">
                        <canvas id="nusangChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: COURSE 2 -->
        <section id="course2" class="hidden fade-in">
            <div class="border-l-4 border-stone-600 pl-4 mb-6">
                <h2 class="text-2xl font-bold serif-font text-stone-800">ì½”ìŠ¤ 2: íš¨ìë™ ì¢…ì  ~ ê´‘í™”ë¬¸</h2>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200 mb-6">
                <p class="text-stone-700 leading-relaxed">ì „ì°¨ì˜ ì¢…ì ì´ì ê¸°ì°¨ì˜ ì‹œì ì´ ë˜ëŠ” ê²½ì„±ì—­ê¹Œì§€ì˜ ê¸¸ì…ë‹ˆë‹¤.</p>
                <div class="mt-6">
                    <div class="chart-container">
                        <canvas id="tramChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: COURSE 3 -->
        <section id="course3" class="hidden fade-in">
            <div class="border-l-4 border-blue-900 pl-4 mb-6">
                <h2 class="text-2xl font-bold serif-font text-stone-800">ì½”ìŠ¤ 3: ê²½ì„±ì—­ ~ ì—°í¬ì—­</h2>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200 mb-6">
                <p class="text-stone-700 leading-relaxed">í„°ë„ì„ ì§€ë‚˜ í•™êµë¡œ í–¥í•˜ë©° ì‹œëŒ€ì˜ ê³ í†µì„ ëª©ê²©í•œ ê¸¸ì…ë‹ˆë‹¤.</p>
                <div class="mt-6">
                    <div class="chart-container">
                        <canvas id="commuteChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION: ACTIVITIES -->
        <section id="activities" class="hidden fade-in">
            <div class="border-l-4 border-green-700 pl-4 mb-6">
                <h2 class="text-2xl font-bold serif-font text-stone-800">í•™ìƒ í™œë™</h2>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200">
                <ul class="space-y-4">
                    <li class="flex items-center gap-3">
                        <input type="checkbox" class="w-5 h-5"> 
                        <span>ëˆ„ìƒë™ í•˜ìˆ™ì§‘ í„°ì—ì„œ ì‹œ ë‚­ì†¡í•˜ê¸°</span>
                    </li>
                    <li class="flex items-center gap-3">
                        <input type="checkbox" class="w-5 h-5"> 
                        <span>âœ¨ AI ì²´í—˜ ì„¼í„°ì—ì„œ ì‹œì¸ê³¼ ëŒ€í™”í•œ ë‚´ìš©ì„ ê¸°ë¡í•˜ê¸°</span>
                    </li>
                </ul>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-stone-800 text-stone-400 py-8 mt-auto text-center">
        <p class="serif-font text-lg mb-2">"ì¢…ì ì´ ì‹œì ì´ ëœë‹¤. ë‹¤ì‹œ ì‹œì ì´ ì¢…ì ì´ ëœë‹¤."</p>
        <p class="text-xs text-stone-600">Â© 2026 ìœ¤ë™ì£¼ ì„œìš¸ ë‹µì‚¬ í”„ë¡œì íŠ¸</p>
    </footer>

    <script>
        const apiKey = "";
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Helper: Exponential Backoff Retry
        async function fetchWithRetry(url, options, retries = 5, delay = 1000) {
            try {
                const response = await fetch(url, options);
                if (!response.ok) throw new Error(`HTTP Error: ${response.status}`);
                return await response.json();
            } catch (error) {
                if (retries <= 0) throw error;
                await new Promise(resolve => setTimeout(resolve, delay));
                return fetchWithRetry(url, options, retries - 1, delay * 2);
            }
        }

        // Feature 1: AI Chat (Text Generation)
        async function askAI() {
            const input = document.getElementById('chat-input');
            const box = document.getElementById('chat-box');
            const loader = document.getElementById('chat-loader');
            const query = input.value.trim();
            if (!query) return;

            // Update UI
            appendMessage('User', query);
            input.value = "";
            loader.classList.remove('hidden');

            const systemPrompt = `ë‹¹ì‹ ì€ 1941ë…„ ì„œìš¸ ëˆ„ìƒë™ í•˜ìˆ™ì§‘ì— ì‚´ê³  ìˆëŠ” 25ì„¸ ì²­ë…„ ì‹œì¸ ìœ¤ë™ì£¼ì…ë‹ˆë‹¤. 
            ì‹ë¯¼ì§€ ì§€ì‹ì¸ìœ¼ë¡œì„œì˜ ë¶€ë„ëŸ¬ì›€, ì—°í¬ì „ë¬¸í•™êµ í•™ìƒìœ¼ë¡œì„œì˜ ì¼ìƒ, ë²— ì •ë³‘ìš±ì— ëŒ€í•œ ì• ì •, 
            ì¸ì™•ì‚° ìˆ˜ì„±ë™ ê³„ê³¡ ì‚°ì±…ì˜ ì¦ê±°ì›€ ë“±ì„ ë°”íƒ•ìœ¼ë¡œ 1ì¸ì¹­ ì‹œì ìœ¼ë¡œ ì •ì¤‘í•˜ê³  ì„±ì°°ì ì¸ ì–´íˆ¬ë¡œ ë‹µí•˜ì„¸ìš”. 
            ì‹œëŒ€ì  ë°°ê²½ì€ íƒœí‰ì–‘ ì „ìŸì´ ë°œë°œí•˜ê¸° ì§ì „ì˜ ê¸´ì¥ëœ ë¶„ìœ„ê¸°ë¥¼ ë°˜ì˜í•©ë‹ˆë‹¤.`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: query }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] }
            };

            try {
                const data = await fetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "ì£„ì†¡í•©ë‹ˆë‹¤, ì ì‹œ ê³ ë‡Œì— ë¹ ì¡Œë‚˜ ë´…ë‹ˆë‹¤.";
                appendMessage('Poet', text);
            } catch (err) {
                appendMessage('Error', 'ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
            } finally {
                loader.classList.add('hidden');
            }
        }

        function appendMessage(role, text) {
            const box = document.getElementById('chat-box');
            const div = document.createElement('div');
            div.className = role === 'User' ? 'text-right' : 'text-left';
            const span = document.createElement('div');
            span.className = `inline-block p-2 rounded-lg text-sm ${role === 'User' ? 'bg-amber-100 text-amber-900' : (role === 'Error' ? 'bg-red-50 text-red-800' : 'bg-stone-200 text-stone-800')}`;
            span.innerText = `${role === 'Poet' ? 'ë™ì£¼: ' : ''}${text}`;
            div.appendChild(span);
            box.appendChild(div);
            box.scrollTop = box.scrollHeight;
        }

        // Feature 2: AI Image (Image Generation)
        async function generateAIImage() {
            const promptInput = document.getElementById('image-prompt');
            const resultBox = document.getElementById('image-result');
            const loader = document.getElementById('image-loader');
            const prompt = promptInput.value.trim();
            if (!prompt) return;

            loader.classList.remove('hidden');
            resultBox.innerHTML = '<div class="text-stone-400">ì‹œëŒ€ë¥¼ ê·¸ë¦¬ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>';

            const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
            const fullPrompt = `Vintage black and white photography style, 1941 Seoul Gyeongseong Korea, historical accuracy, cinematic lighting, ${prompt}`;
            const payload = {
                instances: { prompt: fullPrompt },
                parameters: { sampleCount: 1 }
            };

            try {
                const data = await fetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const imageUrl = `data:image/png;base64,${data.predictions[0].bytesBase64Encoded}`;
                resultBox.innerHTML = `<img src="${imageUrl}" class="w-full h-full object-cover rounded-lg shadow-inner">`;
            } catch (err) {
                resultBox.innerHTML = '<div class="text-red-500">ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>';
            } finally {
                loader.classList.add('hidden');
            }
        }

        // UI Core Logic
        function navigateTo(targetId) {
            document.querySelectorAll('section').forEach(sec => sec.classList.add('hidden'));
            document.getElementById(targetId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.target === targetId);
            });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }

        // Charts Initialization
        function initCharts() {
            const commonOptions = { responsive: true, maintainAspectRatio: false };
            
            new Chart(document.getElementById('nusangChart'), {
                type: 'polarArea',
                data: {
                    labels: ['ìì—°', 'ìš°ì •', 'ì˜ˆìˆ ', 'ì‹œëŒ€ê³ ë‡Œ', 'ì„±ì°°'],
                    datasets: [{ data: [5, 5, 3, 4, 5], backgroundColor: ['#15803d', '#eab308', '#a855f7', '#64748b', '#3b82f6'] }]
                },
                options: commonOptions
            });

            new Chart(document.getElementById('tramChart'), {
                type: 'bar',
                data: {
                    labels: ['1899', '1910', '1917', '1923'],
                    datasets: [{ label: 'ë…¸ì„  í™•ì¥ ë‹¨ê³„', data: [1, 2, 3, 4], backgroundColor: '#78350f' }]
                },
                options: commonOptions
            });

            new Chart(document.getElementById('commuteChart'), {
                type: 'line',
                data: {
                    labels: ['ì¶œë°œ', 'í„°ë„ ì§„ì…', 'ê³µì‚¬ì¥', 'í•™êµ ë„ì°©'],
                    datasets: [{ label: 'ì‹¬ë¦¬ì  ì¤‘ì••ê°', data: [2, 4, 5, 3], borderColor: '#1e3a8a', fill: true }]
                },
                options: commonOptions
            });
        }

        window.onload = initCharts;

        // Enter key for Chat
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') askAI();
        });
    </script>
</body>
</html>
